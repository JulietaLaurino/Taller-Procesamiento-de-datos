<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Procesamiento de datos con tidyverse</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Mini-taller</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="Procesar_datos_GORILLA_1.html">Parte 1</a>
</li>
<li>
  <a href="Procesar_datos_GORILLA_2.html">Parte 2</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Procesamiento de datos con tidyverse</h1>

</div>


<div id="parte-1" class="section level1">
<h1><strong>Parte 1</strong></h1>
<hr />
<div id="configuraciones-iniciales" class="section level2">
<h2><strong>Configuraciones iniciales</strong></h2>
<div id="paquetes" class="section level4">
<h4><strong>Paquetes</strong></h4>
<p>Primero instalo los paquetes que voy a necesitar. Esto lo vas a tener que hacer una única vez (no hace falta correrlo cada vez que corres el script). Es más prolijo si ponemos todos al principio aunque algunos paquetes los usemos más adelante.</p>
<pre class="r"><code>install.packages(&quot;tidyverse&quot;)
install.packages(&quot;xlsx&quot;)</code></pre>
</div>
<div id="directorio-de-trabajo" class="section level4">
<h4><strong>Directorio de trabajo</strong></h4>
<p>Luego vamos a setear el directorio de trabajo correspondiente. Acá poné la carpeta en la que hayas guardado los archivos que vamos a usar. Tené en cuenta que tenés que usar una barra hacia la derecha (“/”) o dos hacia la izquierda (“\”) para escribir el directorio. De lo contrario, te va a tirar error.</p>
<pre class="r"><code>setwd(&quot;C:/Users/User/Desktop/Taller - Procesamiento de datos&quot;)</code></pre>
</div>
</div>
<div id="paso-1-leo-y-almaceno-la-base-de-datos" class="section level2">
<h2><strong>Paso 1: Leo y almaceno la base de datos</strong></h2>
<div id="descargar-desde-gorilla" class="section level4">
<h4><strong>Descargar desde Gorilla</strong></h4>
<p>Te recomiendo que descargues los archivos de gorilla en formato csv. Si son muchos datos el formato excel va a tardar y hasta puede tirar error. Para saber a qué tarea corresponde cada archivo tenés que tener en cuenta que cada uno está identificado por el código del experimento, la versión del mismo y el código de la tarea (alfanumérico de 4 caracteres). Como voy a analizar el priming, me fijo este código alfanumérico en la pantalla de diseño del experimento, como muestro acá abajo:</p>
<p><img src="Archivos_gorilla.png" width="800" /></p>
</div>
<div id="ahora-sí-leo-y-almaceno" class="section level4">
<h4><strong>Ahora sí, leo y almaceno</strong></h4>
<p>Por suerte Gorilla me da los datos ordenados (repasemos, cada columna es una variable y cada observación una fila) ¡Un paso menos! En la Parte 2 voy a explicar cómo deberíamos hacer para transformar nuestros datos en <em>tidy data</em> si no lo fueran. Dado que hice dos versiones del experimento (versión 14 y 15) tengo dos bases de datos diferentes. Usando <code>read.csv()</code> voy a leerlas. Además las voy a almacenar eligiendo un nombre para cada una y usando el operador de asignación <code>&lt;-</code></p>
<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## -- Attaching packages ------------------------ tidyverse 1.3.0 --</code></pre>
<pre><code>## v ggplot2 3.3.0     v purrr   0.3.4
## v tibble  3.0.1     v dplyr   0.8.5
## v tidyr   1.1.0     v stringr 1.4.0
## v readr   1.3.1     v forcats 0.5.0</code></pre>
<pre><code>## -- Conflicts --------------------------- tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>data_v14 &lt;- read.csv(&quot;data_exp_11854-v14_task-5ksx.csv&quot;)
data_v15 &lt;- read.csv(&quot;data_exp_11854-v15_task-5ksx.csv&quot;)</code></pre>
<p>Aclaración: si bien ya instalamos los paquetes y no es necesario instalarlos cada vez que iniciamos R, <strong>sí</strong> tenemos que cargarlos en nuestra libreria si los usamos. Es por eso que cada vez que abramos este script vamos a tener que correr la línea <code>library(tidiverse)</code>.</p>
</div>
</div>
<div id="paso-2-unir-bases-de-datos" class="section level2">
<h2><strong>Paso 2: Unir bases de datos</strong></h2>
<p>Si bien tengo dos versiones del experimento, quiero tener todos los datos juntos en una única base de datos. Es por eso que vamos a unir las dos bases de datos una arriba de la otra dado que comparten las mismas variables (columnas). Esto se hace con <code>bind_rows()</code>.</p>
<pre class="r"><code>data_raw &lt;- bind_rows(data_v14, data_v15)</code></pre>
<p>Acá no lo hago, pero si quisieras identificar a cada base de datos podés agregar dentro de <code>bind_rows()</code> el argumento de <code>.id = "nombre de columna"</code>. Va a crear una nueva columna llamada “nombre de columna” y va a asignarle un <code>1</code> a las filas de la primera base (data_v14) y un <code>2</code> a las filas de la segunda (data_v15).</p>
</div>
<div id="paso-3-renombro-columas" class="section level2">
<h2><strong>Paso 3: Renombro columas</strong></h2>
<p>Los nombres de algunas de las variables (columnas) vienen predeterminados por Gorilla y no son muy intuitivos. Es por eso que me resulta cómodo cambiarlos y así poder identificar los datos de mejor forma. Esto lo podemos hacer de utilizando <code>rename()</code> y asignando un nuevo nombre (que escribo primero y entre comillas) a cada una de las columnas a renombrar.</p>
<pre class="r"><code>data_raw &lt;- rename(data_raw,&quot;id&quot; = Participant.Public.ID, &quot;group&quot; = randomiser.qg34, &quot;RT&quot; = Reaction.Time, &quot;Acc&quot; = Correct, &quot;relation&quot; = primeType, &quot;familiarity&quot; = trialType, &quot;block&quot; =    block_testingSR) </code></pre>
<p>Fiajate que lo primero que escribo es el nombre de la base de datos que contiene estas columnas y después todo lo que corresponde particularmente a esta función. Esto lo vamos a hacer para todas las funciones que usemos.</p>
</div>
<div id="paso-4-filtro-filas" class="section level2">
<h2><strong>Paso 4: Filtro filas</strong></h2>
<p>Ahora bien, Gorilla nos da muchíiiiisima información acerca de cada participante y para analizar los datos es probable que no la necesitemos toda. Un primer paso para el filtrado de toda esta data es quedarme sólo con las filas que tienen información importante.</p>
<p>En este caso, me interesan sólo las respuestas de la <em>tarea</em> (eliminando el demo) asociadas al <em>target</em>. Para saber cómo identificar esa partecita del experimento vamos a volver un poco a Gorilla. Lo que vemos acá abajo es el Task Builder (en donde armamos la tarea). Lo que sería cada ensayo se denomina <em>display</em>, mientras que cada pantalla que tiene ese ensayo se denomina <em>screen</em>. Es recomendable poner nombres informativos que nos ayuden a rastrear lo que nos interesa en nuestra base de datos.</p>
<p><img src="Screen.Name_gorilla.png" width="600" /></p>
<p>Buscando en nuestra base de datos podemos ver que las variables <code>display</code> y <code>Screen.Name</code> son aquellas que debería filtrar. Me quiero quedar sólo con las filas en las que la variable <code>display</code> sea <code>Tarea</code> para no analizar los datos que corresponden al demo inicial. Además me quiero quedar sólo con aquellas filas en las que la variable <code>Screen.Name</code> sea <code>target</code>, como vemos acá abajo.</p>
<p><img src="Filter_gorilla.png" width="800" /></p>
<p>Para esto uso la función <code>filter()</code>, la cual extrae (y se queda con) las filas que cumplen con un criterio lógico, el cual vamos a especificar.</p>
<pre class="r"><code>data_raw &lt;- filter (data_raw, Screen.Name == &quot;target&quot;, display == &quot;Tarea&quot;) </code></pre>
<p>Fijate que todo esto se indica con el operador relacional <code>==</code> el cual chequea si cada elemento del primer vector es igual al segundo (no confundir con el operador <code>=</code> que se usa para asignar). Hay otros criterios lógicos que podemos usar para filtrar datos, como <code>&gt;</code>, <code>&lt;</code>, <code>!</code>, entre otros.</p>
</div>
<div id="paso-5-selecciono-columnas" class="section level2">
<h2><strong>Paso 5: Selecciono columnas</strong></h2>
<p>Otro paso importante para descartar información que no me interesa analizar es la selección de columnas. Para esto podemos usar <code>select()</code> y especificar con cuáles queremos quedarnos. También podríamos aclarar con qué columnas <strong>no</strong> queremos quedarnos (es decir, cuáles queremos que se vayan) agregando un <code>-</code> antes de cada nombre.</p>
<pre class="r"><code>data_raw &lt;- select (data_raw, id, group, relation, familiarity, block, prime, target, Response, Acc, RT) </code></pre>
</div>
<div id="bonus-track-i-ordeno-filas" class="section level2">
<h2><strong>Bonus track I: Ordeno filas</strong></h2>
<p>Si bien no es un paso esencial para el análisis de datos, a mí me gusta y ayuda a la visualización. Por eso agregué este primer bonus track en donde vamos a ordenar las filas usando <code>arrange()</code> y aclarando la columna que quiero ordenar. Por default va a ordenarlas de menor a mayor o en orden alfabético. Si escribimos más de una columna se van a ir sumando los niveles de ordenamiento.</p>
<pre class="r"><code>data_raw &lt;- arrange (data_raw, group, id, familiarity, block, target)</code></pre>
</div>
<div id="bonus-track-ii-nuevas-columnas" class="section level2">
<h2><strong>Bonus track II: Nuevas columnas</strong></h2>
<p>Otro paso muchas veces útil es generar una nueva columna. Esta nueva columna podría resultar de una operación tomando como input una o más columnas existentes, o simplemente tener un valor determinado. En cualquiera de los casos, vamos a utilizar la función <code>mutate()</code>. En el ejemplo que doy acá abajo, quiero generar una nueva columna denominada “accRT” que incluya sólo los RTs en los que la respuesta fue correcta. Sin entrar en detalles, esto lo puedo hacer utilizando <code>ifelse</code> que va a ir fila por fila evaluando lo que le indico. Acá estoy indicando: “si el valor de la columna <code>Acc</code> es <code>1</code>, entonces el valor que toma la nueva columna <code>accRT</code> es el mismo que el de la columna <code>RT</code>. De lo contrario, el valor que toma es <code>NA</code>”.</p>
<pre class="r"><code>data_raw &lt;- mutate(data_raw, accRT = ifelse(Acc == 1, RT, NA))
slice(data_raw, 1:10)</code></pre>
<pre><code>##                 id         group  relation familiarity block     prime   target
## 1  Agustina Carpio No reactivado unrelated    familiar     1     clavo  ARDILLA
## 2  Agustina Carpio No reactivado   related    familiar     1    nueces  ARDILLA
## 3  Agustina Carpio No reactivado unrelated    familiar     1     golpe  BAÃ‘ERA
## 4  Agustina Carpio No reactivado   related    familiar     1     ducha  BAÃ‘ERA
## 5  Agustina Carpio No reactivado   related    familiar     1    jinete  CABALLO
## 6  Agustina Carpio No reactivado unrelated    familiar     1    telÃ³n  CABALLO
## 7  Agustina Carpio No reactivado unrelated    familiar     1 pantalÃ³n CALABAZA
## 8  Agustina Carpio No reactivado   related    familiar     1   verdura CALABAZA
## 9  Agustina Carpio No reactivado   related    familiar     1  descanso COLCHÃ“N
## 10 Agustina Carpio No reactivado unrelated    familiar     1    galera COLCHÃ“N
##     Response Acc       RT    accRT
## 1  unrelated   1  748.495  748.495
## 2  unrelated   0 1172.140       NA
## 3  unrelated   1  891.535  891.535
## 4    related   1  647.915  647.915
## 5    related   1  686.540  686.540
## 6  unrelated   1  578.105  578.105
## 7  unrelated   1  728.110  728.110
## 8    related   1  602.045  602.045
## 9    related   1 1000.685 1000.685
## 10 unrelated   1 1084.370 1084.370</code></pre>
</div>
<div id="resumen-y-conlusión" class="section level2">
<h2><strong>Resumen y conlusión</strong></h2>
<div id="todo-junto" class="section level3">
<h3><strong>Todo junto!</strong></h3>
<p>Podemos hacer todos los pasos anteriores es un único y gran paso usando la pipa (o pipe) <code>%&gt;%</code>. Lo que estamos indicando cada vez que la usamos es que el argumento que se encuentra a la derecha de la pipa se alimente del que se encuentra a la izquierda. Este operador es muy útil para correr una secuencia de operaciones como muestro a continuación:</p>
<pre class="r"><code>data_raw &lt;- bind_rows(data_v14, data_v15) %&gt;% 
  rename(&quot;id&quot; = Participant.Public.ID, &quot;group&quot; = randomiser.qg34, &quot;RT&quot; = Reaction.Time, &quot;Acc&quot; = Correct, &quot;relation&quot; = primeType, &quot;familiarity&quot; = trialType, &quot;block&quot; =   block_testingSR) %&gt;% 
  filter (Screen.Name == &quot;target&quot;, display == &quot;Tarea&quot;) %&gt;% 
  select (id, group, relation, familiarity, block, prime, target, Response, Acc, RT) %&gt;% 
  arrange (group, id, familiarity, block, target) %&gt;% 
  mutate (accRT = ifelse(Acc == 1, RT, NA))</code></pre>
</div>
<div id="chequeo" class="section level3">
<h3><strong>Chequeo</strong></h3>
<p>Y para finalizar un poco más tranquiles de haber hecho todo bien, después de tanto cambio, está bueno hacer algún chequeo. En este caso vamos a contar la cantidad de trials que le quedó a cada participante. Para eso agrupamos los datos según su <code>id</code> con <code>group_by()</code> y lo que mostramos de cada agrupación es el número de observaciones que agrupé. Esto último lo especifico con <code>count()</code>. Si todo viene bien, y según mis cálculos de acuerdo al diseño, cada participante debería tener 240 observaciones.</p>
<pre class="r"><code>trials_count &lt;- data_raw %&gt;% 
  group_by(id) %&gt;% 
  count()
slice(trials_count, 1:10)</code></pre>
<pre><code>## # A tibble: 70 x 2
## # Groups:   id [70]
##    id                     n
##    &lt;chr&gt;              &lt;int&gt;
##  1 41224648             240
##  2 Agostina Rosales     240
##  3 Agustina Carpio      240
##  4 AgustinaValdenegro   240
##  5 amparo calviÃ±o      240
##  6 AndrÃ©s Santos       240
##  7 Andrea Moratti       240
##  8 Ariana Luppino       240
##  9 Camila Lumani        240
## 10 Camila Sanchez       240
## # ... with 60 more rows</code></pre>
<p>Y ya tenemos nuestra tidy data super tidy :) Pero podemos seguir un poquito más…</p>
</div>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
